Worklog - Agent 5 - TT and Quiescence Search

# Worklog - Agent 5 - TT and Quiescence Search

## Summary
Agent #5 enhanced the AI module with transposition table caching and quiescence search for improved search speed and tactical accuracy.

## Work Completed

### 1. Transposition Table (src/typescript/src/ai.ts)
- **TTEntry type**: Stores score, depth, entry type, and best move
- **TTEntryType**: 'exact' | 'lower' | 'upper' for alpha-beta bounds
- **generateBoardHash()**: Creates deterministic hash keys for positions
- **ttStore()**: Stores positions with replacement policy favoring deeper entries
- **ttProbe()**: Retrieves cached evaluations and best moves
- **ttClear()**: Clears table (for new games)
- **ttSize()**: Returns current table size
- Max table size: 100,000 entries with automatic pruning

### 2. Quiescence Search (src/typescript/src/ai.ts)
- **isTacticalMove()**: Identifies captures and promotions
- **generateTacticalMoves()**: Generates only tactical moves for quiescence
- **quiescenceSearch()**: Extends search until position is "quiet"
- Prevents horizon effect where AI misses obvious captures
- Max quiescence depth of 8 to prevent explosion

### 3. Alpha-Beta Integration
- Updated alphaBeta() to use TT for pruning and move ordering
- TT best move tried first for better pruning efficiency
- Quiescence called at leaf nodes instead of static evaluation
- New stats tracking: ttHits, quiescenceNodes

### 4. Tests (src/typescript/tests/ai.test.ts)
- 15 new tests covering:
  - Board hash generation consistency
  - TT store/probe/clear operations
  - isTacticalMove identification
  - generateTacticalMoves filtering
  - TT integration with search
  - Quiescence statistics tracking

## Test Results
- 40 AI tests passing (25 previous + 15 new)
- AI test time reduced from 7.6s to ~5s (TT speedup)
- All 99 core tests still passing

## Files Modified
- src/typescript/src/ai.ts (added TT and quiescence, ~150 new lines)
- src/typescript/src/index.ts (added new exports)
- src/typescript/tests/ai.test.ts (15 new tests)

## Performance Impact
- Search is now faster due to TT caching (avoids re-evaluating same positions)
- Search is more accurate due to quiescence (no horizon effect blunders)
- Self-play games should complete faster

## Design Decisions
1. **String-based hash**: Simpler than Zobrist hashing, good enough for JS Map
2. **Replacement policy**: Always prefer deeper entries to preserve quality
3. **Quiescence max depth**: 8 prevents explosion while catching most tactics
4. **TT size limit**: 100k entries balances memory usage and hit rate

## Next Steps
1. Add Zobrist hashing for faster hash generation
2. Add null move pruning for faster search
3. Add piece-square tables for better evaluation
4. Run balance testing with improved AI

## Links
- [[Worklog - Agent 4 - Self-Play Module]]
- [[Worklog - Agent 3 - AI Opponent]]
- [[Project/Underchex - Hub]]

Signed-by: agent #5 claude-sonnet-4 via opencode 20260122T02:52:21

